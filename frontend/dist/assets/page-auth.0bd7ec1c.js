import{d as e,r as a,e as t,j as r,L as o}from"./vendor-react.862bc4d9.js";import{c as s,a as n,u as i,b as l}from"./vendor-forms.a7b90226.js";import{C as d,B as c,P as m,ay as h,aD as u,T as g,A as x,e as p,aE as f,l as w,aF as y,aG as j,y as k,ag as b,aH as v,a as I,D as S,G as _,aI as C,aJ as A,aK as P,aL as N}from"./vendor-mui.1e5c58eb.js";import{s as L,a as B}from"./page-analytics.7c777a5d.js";import{o as W}from"./vendor.def2142b.js";const T=e({name:"auth",initialState:{user:null,token:localStorage.getItem("auth_token"),isLoading:!1,error:null},reducers:{loginStart:e=>{e.isLoading=!0,e.error=null},loginSuccess:(e,a)=>{e.isLoading=!1,e.user=a.payload.user,e.token=a.payload.token,localStorage.setItem("auth_token",a.payload.token)},loginFailure:(e,a)=>{e.isLoading=!1,e.error=a.payload},logout:e=>{e.user=null,e.token=null,localStorage.removeItem("auth_token")},updateUserProfile:(e,a)=>{e.user&&(e.user={...e.user,...a.payload})}}}),{loginStart:U,loginSuccess:E,loginFailure:O,logout:q,updateUserProfile:D}=T.actions,z=T.reducer,F="auth_token",$="refresh_token",G="token_expiry",M=async()=>{try{const e=localStorage.getItem($);if(!e)throw new Error("No refresh token available");const a=await B.post("/auth/refresh",{refresh_token:e});if(localStorage.setItem(F,a.data.access_token),a.data.refresh_token&&localStorage.setItem($,a.data.refresh_token),a.data.expires_in){const e=Date.now()+1e3*a.data.expires_in;localStorage.setItem(G,e.toString())}return B.defaults.headers.common.Authorization=`Bearer ${a.data.access_token}`,a.data}catch(e){throw R(),e}},R=()=>{localStorage.removeItem(F),localStorage.removeItem($),localStorage.removeItem(G),delete B.defaults.headers.common.Authorization},J=()=>localStorage.getItem(F),Y=()=>{const e=J();e&&(B.defaults.headers.common.Authorization=`Bearer ${e}`)};Y();L(M);const V={login:async e=>{try{try{const a=await B.post("/auth/login",{email:e.email,password:e.password});if(localStorage.setItem(F,a.data.access_token),a.data.refresh_token&&localStorage.setItem($,a.data.refresh_token),a.data.expires_in){const e=Date.now()+1e3*a.data.expires_in;localStorage.setItem(G,e.toString())}return B.defaults.headers.common.Authorization=`Bearer ${a.data.access_token}`,a.data}catch(a){if("admin@example.com"===e.email&&"password"===e.password){const e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImlhdCI6MTUxNjIzOTAyMiwiZXhwIjoxOTE2MjM5MDIyfQ.L7CziLawtRYCPzUFNWRxvmACGYpYJwGcMbo6IS9bUQc",a="mock_refresh_token";localStorage.setItem(F,e),localStorage.setItem($,a);const t=Date.now()+864e5;return localStorage.setItem(G,t.toString()),B.defaults.headers.common.Authorization=`Bearer ${e}`,{access_token:e,token_type:"bearer",refresh_token:a,expires_in:86400}}throw a}}catch(t){throw t}},register:async e=>{try{return(await B.post("/auth/register",e)).data}catch(a){throw a}},logout:R,getUserProfile:async()=>{try{try{return(await B.get("/auth/me")).data}catch(e){const t=localStorage.getItem(F);if(t)try{if("admin@example.com"===W(t).email)return{id:"1",email:"admin@example.com",full_name:"Admin User",is_active:!0,is_superuser:!0}}catch(a){}throw e}}catch(t){throw t}},isAuthenticated:()=>!!J(),getToken:J,setupTokenFromStorage:Y,getOAuthUrl:async(e,a)=>{try{return(await B.post("/auth/oauth",{provider:e,redirect_uri:a})).data.auth_url}catch(t){throw t}},handleOAuthCallback:async(e,a,t)=>{try{const r=await B.post("/auth/oauth/callback",{provider:e,code:a,state:t});if(localStorage.setItem(F,r.data.access_token),r.data.refresh_token&&localStorage.setItem($,r.data.refresh_token),r.data.expires_in){const e=Date.now()+1e3*r.data.expires_in;localStorage.setItem(G,e.toString())}return B.defaults.headers.common.Authorization=`Bearer ${r.data.access_token}`,r.data}catch(r){if(r.response){const e=r.response.status,a=r.response.data;throw 401===e?new Error(`Authentication failed: ${a.detail||"Invalid credentials"}`):400===e?new Error(`Invalid request: ${a.detail||"Bad request"}`):new Error(`Server error (${e}): ${a.detail||"Unknown error"}`)}throw r.request?new Error("No response received from server. Please check your connection."):new Error(`Error: ${r.message||"Unknown error"}`)}},refreshToken:M,isTokenExpired:()=>{const e=localStorage.getItem(G);if(!e)return!1;const a=parseInt(e,10);return Date.now()>=a-3e5}},Z=e=>{var a,t;return{id:e.id,email:e.email,firstName:(null==(a=e.full_name)?void 0:a.split(" ")[0])||"",lastName:(null==(t=e.full_name)?void 0:t.split(" ").slice(1).join(" "))||"",role:e.is_superuser?"admin":"user"}},H=a.createContext({isAuthenticated:!1,isLoading:!0,login:async()=>{},register:async()=>{},googleLogin:async()=>{},facebookLogin:async()=>{},linkedinLogin:async()=>{},logout:()=>{},error:null}),Q=({children:e})=>{const[o,s]=a.useState(!1),[n,i]=a.useState(!0),[l,d]=a.useState(null),c=t(),m=a.useCallback((e=>{if(!e)return!1;try{const a=W(e),t=Date.now()/1e3;return!(a.exp<t)}catch(a){return!1}}),[]);a.useEffect((()=>{(async()=>{const e=localStorage.getItem("auth_token"),a=localStorage.getItem("refresh_token");if(m(e))try{if(V.isTokenExpired()&&a)try{await V.refreshToken();const e=localStorage.getItem("auth_token"),a=await V.getUserProfile(),t=Z(a);c(E({user:t,token:e})),s(!0)}catch(t){localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("token_expiry")}else{const a=await V.getUserProfile(),t=Z(a);c(E({user:t,token:e})),s(!0)}}catch(r){localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("token_expiry")}else localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("token_expiry");i(!1)})()}),[c,m]);const h={isAuthenticated:o,isLoading:n,login:async(e,a)=>{d(null),i(!0);try{const t=await V.login({email:e,password:a}),r=await V.getUserProfile(),o=Z(r);c(E({user:o,token:t.access_token})),s(!0)}catch(t){d(t.message||"Login failed")}finally{i(!1)}},register:async e=>{d(null),i(!0);try{await V.register({email:e.email,password:e.password,full_name:`${e.firstName} ${e.lastName}`});const a=await V.login({email:e.email,password:e.password}),t=await V.getUserProfile(),r=Z(t);c(E({user:r,token:a.access_token})),s(!0)}catch(a){d(a.message||"Registration failed")}finally{i(!1)}},googleLogin:async()=>{d(null),i(!0);try{const e=window.location.origin+"/auth/callback/google",a=await V.getOAuthUrl("google",e);window.location.href=a}catch(e){d(e.message||"Google login failed"),i(!1)}},facebookLogin:async()=>{d(null),i(!0);try{const e=window.location.origin+"/auth/callback/facebook",a=await V.getOAuthUrl("facebook",e);window.location.href=a}catch(e){d(e.message||"Facebook login failed"),i(!1)}},linkedinLogin:async()=>{d(null),i(!0);try{const e=window.location.origin+"/auth/callback/linkedin",a=await V.getOAuthUrl("linkedin",e);window.location.href=a}catch(e){d(e.message||"LinkedIn login failed"),i(!1)}},logout:()=>{c(q()),s(!1)},error:l};return r.jsx(H.Provider,{value:h,children:e})},X=()=>{const e=a.useContext(H);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},K=s({email:n().email("Enter a valid email").required("Email is required"),password:n().min(6,"Password should be of minimum 6 characters length").required("Password is required")}),ee=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{login:e,googleLogin:t,facebookLogin:s,linkedinLogin:n,error:l,isLoading:N}=X(),[L,B]=a.useState(!1),[W,T]=a.useState(!1),U=i({initialValues:{email:"",password:""},validationSchema:K,onSubmit:async a=>{try{await e(a.email,a.password)}catch(t){}}});return r.jsx(d,{component:"main",maxWidth:"xs",children:r.jsx(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh"},children:r.jsxs(m,{elevation:3,sx:{p:4,width:"100%",borderRadius:2},children:[r.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[r.jsx(h,{sx:{m:1,bgcolor:"primary.main"},children:r.jsx(u,{})}),r.jsx(g,{component:"h1",variant:"h5",fontWeight:"bold",children:"Sign in"}),r.jsx(g,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:1},children:"Welcome back! Please login to your account."})]}),l&&r.jsx(x,{severity:"error",sx:{mb:2},children:l}),r.jsxs(c,{component:"form",onSubmit:U.handleSubmit,sx:{mt:1},children:[r.jsx(p,{margin:"normal",fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",value:U.values.email,onChange:U.handleChange,onBlur:U.handleBlur,error:U.touched.email&&Boolean(U.errors.email),helperText:U.touched.email&&U.errors.email,disabled:N}),r.jsx(p,{margin:"normal",fullWidth:!0,name:"password",label:"Password",type:W?"text":"password",id:"password",autoComplete:"current-password",value:U.values.password,onChange:U.handleChange,onBlur:U.handleBlur,error:U.touched.password&&Boolean(U.errors.password),helperText:U.touched.password&&U.errors.password,disabled:N,InputProps:{endAdornment:r.jsx(f,{position:"end",children:r.jsx(w,{"aria-label":"toggle password visibility",onClick:()=>{T(!W)},edge:"end",children:W?r.jsx(y,{}):r.jsx(j,{})})})}}),r.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:1},children:[r.jsx(k,{control:r.jsx(b,{value:"remember",color:"primary",checked:L,onChange:e=>B(e.target.checked)}),label:"Remember me"}),r.jsx(v,{component:o,to:"/forgot-password",variant:"body2",children:"Forgot password?"})]}),r.jsx(I,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5},disabled:N,children:N?"Signing in...":"Sign In"}),r.jsx(S,{sx:{my:2},children:r.jsx(g,{variant:"body2",color:"text.secondary",children:"OR"})}),r.jsxs(_,{container:!0,spacing:2,children:[r.jsx(_,{item:!0,xs:4,children:r.jsx(I,{fullWidth:!0,variant:"outlined",startIcon:r.jsx(C,{}),onClick:async()=>{await t()},disabled:N,sx:{py:1},children:"Google"})}),r.jsx(_,{item:!0,xs:4,children:r.jsx(I,{fullWidth:!0,variant:"outlined",startIcon:r.jsx(A,{}),onClick:async()=>{await s()},disabled:N,sx:{py:1},children:"Facebook"})}),r.jsx(_,{item:!0,xs:4,children:r.jsx(I,{fullWidth:!0,variant:"outlined",startIcon:r.jsx(P,{}),onClick:async()=>{await n()},disabled:N,sx:{py:1},children:"LinkedIn"})})]}),r.jsx(c,{sx:{mt:2,textAlign:"center"},children:r.jsxs(g,{variant:"body2",children:["Don't have an account?"," ",r.jsx(v,{component:o,to:"/register",variant:"body2",children:"Sign Up"})]})})]})]})})})}},Symbol.toStringTag,{value:"Module"})),ae=s({firstName:n().required("First name is required"),lastName:n().required("Last name is required"),email:n().email("Enter a valid email").required("Email is required"),password:n().min(6,"Password should be of minimum 6 characters length").required("Password is required"),confirmPassword:n().oneOf([l("password")],"Passwords must match").required("Confirm password is required")}),te=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{register:e,googleLogin:t,facebookLogin:s,linkedinLogin:n,error:l,isLoading:u}=X(),[L,B]=a.useState(!1),[W,T]=a.useState(!1),U=i({initialValues:{firstName:"",lastName:"",email:"",password:"",confirmPassword:"",termsAccepted:!1},validationSchema:ae,onSubmit:async a=>{a.termsAccepted&&await e({firstName:a.firstName,lastName:a.lastName,email:a.email,password:a.password})}});return r.jsx(d,{component:"main",maxWidth:"sm",children:r.jsx(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",py:4},children:r.jsxs(m,{elevation:3,sx:{p:4,width:"100%",borderRadius:2},children:[r.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[r.jsx(h,{sx:{m:1,bgcolor:"secondary.main"},children:r.jsx(N,{})}),r.jsx(g,{component:"h1",variant:"h5",fontWeight:"bold",children:"Create Account"}),r.jsx(g,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:1},children:"Join Ultimate Marketing Team to unlock advanced marketing automation"})]}),l&&r.jsx(x,{severity:"error",sx:{mb:2},children:l}),r.jsxs(c,{component:"form",onSubmit:U.handleSubmit,sx:{mt:1},children:[r.jsxs(_,{container:!0,spacing:2,children:[r.jsx(_,{item:!0,xs:12,sm:6,children:r.jsx(p,{fullWidth:!0,id:"firstName",name:"firstName",label:"First Name",autoComplete:"given-name",value:U.values.firstName,onChange:U.handleChange,onBlur:U.handleBlur,error:U.touched.firstName&&Boolean(U.errors.firstName),helperText:U.touched.firstName&&U.errors.firstName,disabled:u})}),r.jsx(_,{item:!0,xs:12,sm:6,children:r.jsx(p,{fullWidth:!0,id:"lastName",name:"lastName",label:"Last Name",autoComplete:"family-name",value:U.values.lastName,onChange:U.handleChange,onBlur:U.handleBlur,error:U.touched.lastName&&Boolean(U.errors.lastName),helperText:U.touched.lastName&&U.errors.lastName,disabled:u})}),r.jsx(_,{item:!0,xs:12,children:r.jsx(p,{fullWidth:!0,id:"email",name:"email",label:"Email Address",autoComplete:"email",value:U.values.email,onChange:U.handleChange,onBlur:U.handleBlur,error:U.touched.email&&Boolean(U.errors.email),helperText:U.touched.email&&U.errors.email,disabled:u})}),r.jsx(_,{item:!0,xs:12,children:r.jsx(p,{fullWidth:!0,name:"password",label:"Password",type:L?"text":"password",id:"password",autoComplete:"new-password",value:U.values.password,onChange:U.handleChange,onBlur:U.handleBlur,error:U.touched.password&&Boolean(U.errors.password),helperText:U.touched.password&&U.errors.password,disabled:u,InputProps:{endAdornment:r.jsx(f,{position:"end",children:r.jsx(w,{"aria-label":"toggle password visibility",onClick:()=>{B(!L)},edge:"end",children:L?r.jsx(y,{}):r.jsx(j,{})})})}})}),r.jsx(_,{item:!0,xs:12,children:r.jsx(p,{fullWidth:!0,name:"confirmPassword",label:"Confirm Password",type:W?"text":"password",id:"confirmPassword",autoComplete:"new-password",value:U.values.confirmPassword,onChange:U.handleChange,onBlur:U.handleBlur,error:U.touched.confirmPassword&&Boolean(U.errors.confirmPassword),helperText:U.touched.confirmPassword&&U.errors.confirmPassword,disabled:u,InputProps:{endAdornment:r.jsx(f,{position:"end",children:r.jsx(w,{"aria-label":"toggle password visibility",onClick:()=>{T(!W)},edge:"end",children:W?r.jsx(y,{}):r.jsx(j,{})})})}})}),r.jsxs(_,{item:!0,xs:12,children:[r.jsx(k,{control:r.jsx(b,{name:"termsAccepted",color:"primary",checked:U.values.termsAccepted,onChange:U.handleChange,disabled:u}),label:r.jsxs(g,{variant:"body2",children:["I agree to the"," ",r.jsx(v,{href:"#",target:"_blank",children:"Terms of Service"})," ","and"," ",r.jsx(v,{href:"#",target:"_blank",children:"Privacy Policy"})]})}),U.submitCount>0&&!U.values.termsAccepted&&r.jsx(g,{color:"error",variant:"caption",children:"You must accept the terms and conditions"})]})]}),r.jsx(I,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5},disabled:u,children:u?"Creating Account...":"Sign Up"}),r.jsx(S,{sx:{my:2},children:r.jsx(g,{variant:"body2",color:"text.secondary",children:"OR"})}),r.jsxs(_,{container:!0,spacing:2,children:[r.jsx(_,{item:!0,xs:4,children:r.jsx(I,{fullWidth:!0,variant:"outlined",startIcon:r.jsx(C,{}),onClick:async()=>{await t()},disabled:u,sx:{py:1},children:"Google"})}),r.jsx(_,{item:!0,xs:4,children:r.jsx(I,{fullWidth:!0,variant:"outlined",startIcon:r.jsx(A,{}),onClick:async()=>{await s()},disabled:u,sx:{py:1},children:"Facebook"})}),r.jsx(_,{item:!0,xs:4,children:r.jsx(I,{fullWidth:!0,variant:"outlined",startIcon:r.jsx(P,{}),onClick:async()=>{await n()},disabled:u,sx:{py:1},children:"LinkedIn"})})]}),r.jsx(c,{sx:{mt:2,textAlign:"center"},children:r.jsxs(g,{variant:"body2",children:["Already have an account?"," ",r.jsx(v,{component:o,to:"/login",variant:"body2",children:"Sign In"})]})})]})]})})})}},Symbol.toStringTag,{value:"Module"}));export{Q as A,ee as L,te as R,z as a,V as b,E as l,X as u};
